## 设计方案基于redis sub/pub + tornado websocket.

## 功能设计说明
websocket 提供长链接，tornado提供并发能力。

redis sub/pub 提供消息的监听与派发。
redis pipe 提供消息的持久化。

长连接中设计了两个定时器，一个用于与客户端保持联系，一个用于检查新消息并将消息发送给客户端。

消息使用售票机制进行计数，保证消息的唯一性。

消息使用应答回复机制，保证消息发送的可靠性。

tornado server需要5s以上，才能完全断开客户端的连接。

## 遇到的问题？

1. 当客户端由于网络状态断开连接后，服务端并不知情。需要通过定时器才能发现被动发送并断开连接。

2. 此时，客户端重新建立连接。客户端通过新的连接与服务端进行通信。旧的连接通过等待超时而关闭。

